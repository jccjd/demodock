<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>VIBE Studio - Integrated Test Environment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #333; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .sidebar-icon-active { border-left: 2px solid #2563eb; color: #2563eb !important; background: #f0f7ff; }
        .vnc-area { background: #f3f4f6; position: relative; }
        .custom-scrollbar::-webkit-scrollbar { width: 3px; height: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
        .ide-panel-header { background: #f9fafb; border-bottom: 1px solid #e5e7eb; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden text-[13px]">

    <!-- é¡¶éƒ¨èœå•/å·¥å…·æ  (å…¨å±€çŠ¶æ€) -->
    <header class="h-10 border-b border-slate-200 flex items-center justify-between px-4 bg-white z-50">
        <div class="flex items-center space-x-6">
            <div class="flex items-center space-x-2">
                <div class="w-6 h-6 bg-blue-600 rounded flex items-center justify-center text-white font-bold text-[10px]">V</div>
                <span class="font-bold text-slate-700 tracking-tight">VIBE STUDIO</span>
            </div>
            <div class="flex items-center space-x-1 text-slate-400">
                <span>Projects</span>
                <span class="text-slate-300">/</span>
                <span class="text-slate-900 font-medium italic">cTDP_Consistency_Test</span>
            </div>
        </div>
        <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-2 px-3 py-1 bg-green-50 rounded-full border border-green-100">
                <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                <span class="text-[10px] text-green-700 font-bold uppercase tracking-wider">Hygon 7002 Connected</span>
            </div>
            <button class="bg-blue-600 text-white px-4 py-1 rounded text-[11px] font-bold shadow-sm hover:bg-blue-700">Submit Report</button>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        
        <!-- 1. å·¦ä¾§æœ€çª„ä¾§è¾¹æ  (Activity Bar) -->
        <nav class="w-12 border-r border-slate-200 flex flex-col items-center py-4 space-y-6 bg-white">
            <div class="sidebar-icon-active p-2 text-slate-400 hover:text-blue-600 transition-colors cursor-pointer">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" stroke-width="2"></path></svg>
            </div>
            <div class="p-2 text-slate-400 hover:text-blue-600 transition-colors cursor-pointer">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" stroke-width="2"></path></svg>
            </div>
            <div class="p-2 text-slate-400 hover:text-blue-600 transition-colors cursor-pointer">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2"></path></svg>
            </div>
        </nav>

        <!-- 2. å·¦ä¾§ä¸»ä¾§è¾¹æ  (Explorer - Step Info) -->
        <aside class="w-64 border-r border-slate-200 flex flex-col bg-white">
            <div class="ide-panel-header px-4 py-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">
                Test Case Explorer
            </div>
            <div class="flex-1 overflow-y-auto custom-scrollbar py-2">
                <!-- æµ‹è¯•ç”¨ä¾‹ä¿¡æ¯ç»„ -->
                <div class="px-4 py-2 group">
                    <div class="flex items-center text-[11px] font-bold text-slate-400 mb-2 uppercase tracking-tighter">
                        <svg class="w-3 h-3 mr-1 transform rotate-90" fill="currentColor" viewBox="0 0 20 20"><path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"></path></svg>
                        Steps Details
                    </div>
                    <div class="space-y-1 ml-4 border-l border-slate-100">
                        <div class="pl-4 py-1 text-blue-600 font-bold bg-blue-50 border-r-2 border-blue-600 cursor-pointer">01. BIOS Config <span class="text-[9px] opacity-50 ml-2">Active</span></div>
                        <div class="pl-4 py-1 text-slate-500 hover:bg-slate-50 cursor-pointer">02. BMC Event Log <span class="text-[9px] opacity-50 ml-2 italic">Waiting</span></div>
                        <div class="pl-4 py-1 text-slate-500 hover:bg-slate-50 cursor-pointer">03. OS Power Stress <span class="text-[9px] opacity-50 ml-2 italic">Waiting</span></div>
                        <div class="pl-4 py-1 text-slate-500 hover:bg-slate-50 cursor-pointer">04. Topology Verify <span class="text-[9px] opacity-50 ml-2 italic">Final</span></div>
                    </div>
                </div>

                <div class="px-4 py-6">
                    <div class="flex items-center text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-widest italic">Target Specification</div>
                    <div class="p-3 bg-slate-50 rounded-lg text-[11px] text-slate-500 leading-relaxed border border-slate-100">
                        Hygon CBS -> NBIO -> cTDP Control -> Manual (Target: 280W)
                    </div>
                </div>
            </div>
        </aside>

        <!-- 3. ä¸­é—´æ ¸å¿ƒè§†å›¾åŒº (Main View - VNC + Panel) -->
        <main class="flex-1 flex flex-col min-w-0 bg-[#f9fafb]">
            <!-- æ ‡ç­¾é¡µ -->
            <div class="h-9 bg-slate-100/50 flex items-end px-4 border-b border-slate-200">
                <div class="px-4 py-2 bg-white border border-b-0 border-slate-200 text-[11px] font-bold text-blue-600 flex items-center space-x-2 rounded-t-md">
                    <span class="w-2 h-2 bg-indigo-500 rounded-full"></span>
                    <span>BIOS Console (Serial)</span>
                    <span class="text-slate-300 ml-2 hover:text-slate-600 cursor-pointer">Ã—</span>
                </div>
                <div class="px-4 py-2 text-[11px] font-medium text-slate-400 hover:text-slate-600 flex items-center space-x-2 cursor-pointer transition-all">
                    <span class="w-2 h-2 bg-slate-300 rounded-full"></span>
                    <span>BMC Web (noVNC)</span>
                </div>
            </div>

            <!-- VNC ä¸»è§†çª— (å°±åƒä»£ç ç¼–è¾‘åŒº) -->
            <div class="flex-1 vnc-area overflow-hidden flex flex-col">
                <div class="flex-1 bg-black m-6 rounded-2xl shadow-2xl overflow-hidden border border-slate-800 flex flex-col relative">
                    <!-- HUD æç¤ºå±‚ -->
                    <div class="absolute top-4 left-1/2 -translate-x-1/2 px-4 py-1.5 bg-blue-600 text-white text-[10px] font-bold rounded-full shadow-lg flex items-center space-x-2 z-10">
                        <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
                        <span>AI ATTACHED: Intercepting BIOS Boot...</span>
                    </div>
                    <!-- VNC å†…å®¹æ¨¡æ‹Ÿ -->
                    <div class="flex-1 flex flex-col p-10 font-mono text-sm leading-relaxed text-blue-100">
                        <p class="text-slate-500 border-b border-slate-800 pb-2 mb-4 italic">Remote Connection: Hygon-7002-Node [Active]</p>
                        <p>> Advanced Chipset Configuration</p>
                        <p class="bg-blue-600 text-white px-2 mt-2 w-max italic">  cTDP Control: [Manual]</p>
                        <p class="mt-1">  - cTDP: [0]</p>
                        <p class="mt-1 text-slate-500 italic">  - Current Status: Saving settings...</p>
                    </div>
                </div>
            </div>

            <!-- åº•éƒ¨é¢æ¿ (Terminal/Output) -->
            <div class="h-48 border-t border-slate-200 bg-white flex flex-col shadow-inner">
                <div class="ide-panel-header px-4 flex items-center space-x-6 h-8 shrink-0">
                    <button class="text-[10px] font-bold text-slate-900 border-b-2 border-blue-600 pb-1">OUTPUT</button>
                    <button class="text-[10px] font-bold text-slate-400 hover:text-slate-600 pb-1">DEBUG CONSOLE</button>
                    <button class="text-[10px] font-bold text-slate-400 hover:text-slate-600 pb-1">REAL-TIME LOGS</button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 custom-scrollbar mono text-[11px] text-slate-600 leading-loose">
                    <div class="flex space-x-4"><span class="text-blue-500">[14:21:05]</span><span class="text-slate-400">INFO: Powering on target system...</span></div>
                    <div class="flex space-x-4"><span class="text-blue-500">[14:21:08]</span><span class="text-slate-400">INFO: AI Agent detected serial output "Hygon Setup Ready".</span></div>
                    <div class="flex space-x-4"><span class="text-indigo-500 font-bold">[14:21:12]</span><span class="text-indigo-600">COMMAND: AI sending 'F2' interrupt key... success.</span></div>
                    <div class="flex space-x-4"><span class="text-emerald-500">[14:21:15]</span><span class="text-slate-500 italic">SYSTEM: Context switched to BIOS Console.</span></div>
                </div>
            </div>
        </main>

        <!-- 4. å³ä¾§ä¾§è¾¹æ  (AI Co-Tester - èåˆ ai_browser_chat) -->
        <aside class="w-96 border-l border-slate-200 flex flex-col bg-gradient-to-b from-slate-50 to-white">
            <!-- é¡¶éƒ¨è¿æ¥çŠ¶æ€ -->
            <div class="px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-between shadow-sm">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
                    </div>
                    <div>
                        <div class="text-white font-bold text-sm">AI Co-Tester</div>
                        <div class="text-blue-100 text-[10px]">é€šè¿‡ iFlow Browser Server</div>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <span id="ws-status-dot" class="w-2.5 h-2.5 bg-slate-400 rounded-full"></span>
                    <span id="ws-status-text" class="text-[10px] text-blue-100 font-medium">æœªè¿æ¥</span>
                </div>
            </div>

            <!-- ç¤ºä¾‹æŒ‡ä»¤ -->
            <div class="px-4 py-3 bg-white border-b border-slate-100">
                <div class="text-[10px] text-slate-400 font-medium mb-2">ğŸ’¡ å¿«æ·æŒ‡ä»¤:</div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="quickCommand('å¸®æˆ‘æ‰“å¼€ç™¾åº¦æœç´¢äººå·¥æ™ºèƒ½')" class="px-3 py-1.5 bg-blue-50 text-blue-600 rounded-full text-[10px] font-medium hover:bg-blue-100 transition-colors">æœç´¢äººå·¥æ™ºèƒ½</button>
                    <button onclick="quickCommand('åˆ—å‡ºå½“å‰å·¥ä½œç›®å½•çš„æ–‡ä»¶')" class="px-3 py-1.5 bg-blue-50 text-blue-600 rounded-full text-[10px] font-medium hover:bg-blue-100 transition-colors">åˆ—å‡ºæ–‡ä»¶</button>
                    <button onclick="quickCommand('å¸®æˆ‘åˆ†æ demo.html çš„ç»“æ„')" class="px-3 py-1.5 bg-blue-50 text-blue-600 rounded-full text-[10px] font-medium hover:bg-blue-100 transition-colors">åˆ†æä»£ç </button>
                </div>
            </div>

            <!-- å¯¹è¯è®°å½• -->
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar">
                <div class="flex justify-center">
                    <div class="text-[10px] text-slate-400 bg-slate-50 px-3 py-2 rounded-full flex items-center space-x-2">
                        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span>ç­‰å¾…è¿æ¥åˆ°æœåŠ¡å™¨...</span>
                    </div>
                </div>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="p-4 bg-white border-t border-slate-200 shadow-lg">
                <div class="relative">
                    <textarea id="chat-input" rows="3" placeholder="è¾“å…¥æŒ‡ä»¤... (Ctrl+Enter å‘é€)" class="w-full bg-slate-50 border border-slate-200 rounded-xl py-3 px-4 pr-12 text-xs outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all resize-none placeholder:text-slate-400 shadow-inner" disabled></textarea>
                    <button id="send-btn" class="absolute right-3 bottom-3 p-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg shadow-md hover:shadow-lg disabled:bg-slate-300 disabled:cursor-not-allowed transition-all" disabled>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                    </button>
                </div>
            </div>
        </aside>

    </div>

    <!-- AI Chat WebSocket è¿æ¥è„šæœ¬ -->
    <script>
        // WebSocket é…ç½® - è¿æ¥åˆ° iflow_browser_server
        const WS_URL = 'ws://localhost:8082/ws';
        let ws = null;
        let isConnected = false;

        // DOM å…ƒç´ 
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const statusDot = document.getElementById('ws-status-dot');
        const statusText = document.getElementById('ws-status-text');

        // è¿æ¥åˆ° WebSocket æœåŠ¡å™¨
        function connectWebSocket() {
            console.log('å°è¯•è¿æ¥åˆ°:', WS_URL);

            try {
                ws = new WebSocket(WS_URL);

                ws.onopen = () => {
                    console.log('WebSocket è¿æ¥æˆåŠŸ');
                    isConnected = true;
                    updateConnectionStatus(true);
                    clearMessages();
                    addSystemMessage('å·²è¿æ¥åˆ° iFlow Browser Server');
                    enableInput(true);
                };

                ws.onmessage = (event) => {
                    console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);
                    const data = event.data;

                    try {
                        const parsed = JSON.parse(data);
                        handleMessage(parsed);
                    } catch (e) {
                        // å¦‚æœä¸æ˜¯ JSONï¼Œç›´æ¥æ˜¾ç¤ºä¸ºæ–‡æœ¬
                        addAIMessage(data);
                    }
                };

                ws.onclose = (event) => {
                    console.log('WebSocket è¿æ¥å…³é—­:', event.code, event.reason);
                    isConnected = false;
                    updateConnectionStatus(false);
                    addSystemMessage('ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥');
                    enableInput(false);
                    // 5ç§’åé‡è¿
                    setTimeout(connectWebSocket, 5000);
                };

                ws.onerror = (error) => {
                    console.error('WebSocket é”™è¯¯:', error);
                    addSystemMessage('è¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ');
                };

            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                addSystemMessage('æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨: ' + error.message);
                // 5ç§’åé‡è¯•
                setTimeout(connectWebSocket, 5000);
            }
        }

        // å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯
        function handleMessage(data) {
            if (data.type === 'assistant' || data.type === 'stream' || data.type === 'message') {
                addAIMessage(data.content || data.message || data.text || '');
            } else if (data.type === 'tool_use') {
                addToolMessage(data.tool, data.args);
            } else if (data.type === 'system') {
                addSystemMessage(data.message || data.content || '');
            } else if (data.type === 'error') {
                addErrorMessage(data.error || data.message || '');
            } else if (data.status === 'error') {
                addErrorMessage(data.error);
            } else if (data.chunk) {
                // æµå¼å“åº”ç‰‡æ®µ
                updateLastAIMessage(data.full_response || data.chunk);
            } else {
                // å°è¯•æ˜¾ç¤ºå†…å®¹
                if (data.content || data.message || data.text) {
                    addAIMessage(data.content || data.message || data.text);
                }
            }
        }

        // æ·»åŠ  AI æ¶ˆæ¯
        function addAIMessage(content) {
            if (!content) return;
            const msgDiv = document.createElement('div');
            msgDiv.className = 'flex justify-start';
            msgDiv.innerHTML = `
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-3 rounded-2xl rounded-tl-none shadow-md text-xs leading-relaxed max-w-[90%]">
                    ${escapeHtml(content)}
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            scrollToBottom();
        }

        // æ›´æ–°æœ€åä¸€æ¡ AI æ¶ˆæ¯ï¼ˆç”¨äºæµå¼å“åº”ï¼‰
        function updateLastAIMessage(content) {
            const messages = chatMessages.querySelectorAll('.flex.justify-start');
            if (messages.length > 0) {
                const lastMsg = messages[messages.length - 1];
                const contentDiv = lastMsg.querySelector('div');
                if (contentDiv) {
                    contentDiv.textContent = content;
                }
            } else {
                addAIMessage(content);
            }
            scrollToBottom();
        }

        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        function addUserMessage(content) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'flex justify-end';
            msgDiv.innerHTML = `
                <div class="bg-slate-200 p-3 rounded-2xl rounded-tr-none shadow text-xs leading-relaxed max-w-[90%]">
                    ${escapeHtml(content)}
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            scrollToBottom();
        }

        // æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯
        function addSystemMessage(content) {
            if (!content) return;
            const msgDiv = document.createElement('div');
            msgDiv.className = 'flex justify-center';
            msgDiv.innerHTML = `
                <div class="text-[10px] text-slate-400 bg-slate-50 px-3 py-1.5 rounded-full flex items-center space-x-1">
                    <span>${escapeHtml(content)}</span>
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            scrollToBottom();
        }

        // æ·»åŠ å·¥å…·è°ƒç”¨æ¶ˆæ¯
        function addToolMessage(tool, args) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'space-y-1';
            msgDiv.innerHTML = `
                <div class="text-[9px] font-bold text-slate-400 uppercase tracking-wider">ğŸ”§ Tool Use</div>
                <div class="bg-slate-50 p-3 rounded-xl border border-slate-200 text-xs">
                    <div class="font-bold text-blue-600 mb-1">${escapeHtml(tool)}</div>
                    <div class="text-slate-500 font-mono text-[10px]">${args ? escapeHtml(JSON.stringify(args, null, 2)) : 'æ— å‚æ•°'}</div>
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            scrollToBottom();
        }

        // æ·»åŠ é”™è¯¯æ¶ˆæ¯
        function addErrorMessage(content) {
            if (!content) return;
            const msgDiv = document.createElement('div');
            msgDiv.className = 'space-y-1';
            msgDiv.innerHTML = `
                <div class="text-[9px] font-bold text-red-400 uppercase tracking-wider">âŒ Error</div>
                <div class="bg-red-50 p-3 rounded-xl border border-red-200 text-xs text-red-700">
                    ${escapeHtml(content)}
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            scrollToBottom();
        }

        // æ¸…ç©ºæ¶ˆæ¯
        function clearMessages() {
            chatMessages.innerHTML = '';
        }

        // æ›´æ–°è¿æ¥çŠ¶æ€
        function updateConnectionStatus(connected) {
            if (connected) {
                statusDot.className = 'w-2.5 h-2.5 bg-green-400 rounded-full animate-pulse';
                statusText.textContent = 'å·²è¿æ¥';
                statusText.className = 'text-[10px] text-green-400 font-medium';
            } else {
                statusDot.className = 'w-2.5 h-2.5 bg-slate-400 rounded-full';
                statusText.textContent = 'æœªè¿æ¥';
                statusText.className = 'text-[10px] text-slate-400 font-medium';
            }
        }

        // å¯ç”¨/ç¦ç”¨è¾“å…¥
        function enableInput(enabled) {
            chatInput.disabled = !enabled;
            sendBtn.disabled = !enabled;
            if (enabled) {
                chatInput.placeholder = 'è¾“å…¥æŒ‡ä»¤... (Ctrl+Enter å‘é€)';
                chatInput.classList.remove('bg-slate-100');
            } else {
                chatInput.placeholder = 'ç­‰å¾…è¿æ¥...';
                chatInput.classList.add('bg-slate-100');
            }
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const content = chatInput.value.trim();
            if (!content || !isConnected) return;

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            addUserMessage(content);
            chatInput.value = '';

            // å‘é€åˆ°æœåŠ¡å™¨
            try {
                ws.send(content);
                console.log('å‘é€æ¶ˆæ¯:', content);
            } catch (error) {
                addErrorMessage('å‘é€å¤±è´¥: ' + error.message);
            }
        }

        // å¿«æ·å‘½ä»¤
        function quickCommand(cmd) {
            chatInput.value = cmd;
            sendMessage();
        }

        // HTML è½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ»šåŠ¨åˆ°åº•éƒ¨
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // äº‹ä»¶ç›‘å¬
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿æ¥
        window.addEventListener('load', () => {
            connectWebSocket();
        });
    </script>

</body>
</html>